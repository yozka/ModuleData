#include "Chart.h"
#include "ChartWidget.h"
///--------------------------------------------------------------------------------------



///--------------------------------------------------------------------------------------
using namespace Chart;
///--------------------------------------------------------------------------------------




///--------------------------------------------------------------------------------------
int gNumberChart = 0;
///--------------------------------------------------------------------------------------





 ///=====================================================================================
///
/// Constructor
/// 
/// 
///--------------------------------------------------------------------------------------
AChart :: AChart ()
	
{
	gNumberChart++;
	mNumber = gNumberChart;

}
///--------------------------------------------------------------------------------------





 ///=====================================================================================
///
/// Destructor
/// 
/// 
///--------------------------------------------------------------------------------------
AChart :: ~AChart ()
{
	clear();
}
///--------------------------------------------------------------------------------------







 ///=====================================================================================
///
/// возвратим название диаграмы
/// 
/// 
///--------------------------------------------------------------------------------------
QString AChart :: title() const
{
	return "Chart mn - " + QString::number(mNumber);
}
///--------------------------------------------------------------------------------------





 ///=====================================================================================
///
/// создание представление данных
/// 
/// 
///--------------------------------------------------------------------------------------
QWidget* AChart :: createWidget()
{
	auto *frame = new AChartWidget();
	connect(frame, &QObject::destroyed, this, &AChart::slot_destroyedWidget);

	frame->setMarking(mMarking);


	mWidgets.append(frame);
	return frame;
}
///--------------------------------------------------------------------------------------






 ///=====================================================================================
///
/// даление виджета
/// 
/// 
///--------------------------------------------------------------------------------------
void AChart :: slot_destroyedWidget(QObject *obj)
{
	auto frame = static_cast<AChartWidget*>(obj);
	if (frame != nullptr)
	{
		frame->clear();
		mWidgets.removeAll(frame);
	}
}
///--------------------------------------------------------------------------------------






 ///=====================================================================================
///
/// очистка всей диаграммы, уберание всех зависемостей
/// 
/// 
///--------------------------------------------------------------------------------------
void AChart :: clear()
{
	mMarking = Marking::PMarkingContainer();
	for(auto item = mWidgets.constBegin(); item != mWidgets.constEnd(); ++item)
	{
		(*item)->clear();
	}
	mWidgets.clear();
}
///--------------------------------------------------------------------------------------





 ///=====================================================================================
///
/// установка действующих закладок
/// 
/// 
///--------------------------------------------------------------------------------------
void AChart :: setMarking(const Marking::PMarkingContainer &marking)
{
	mMarking = marking;
}